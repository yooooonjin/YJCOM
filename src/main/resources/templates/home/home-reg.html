<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
	<head>
		<th:block th:insert="/common/common.html::head" />
		<link rel="stylesheet" href="/css/home/home-reg.css">
		<link rel="stylesheet" href="/css/common/header-nav.css">
		<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
		<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
		<!-- /////////////////////////ajax+시큐리티 사용 시//////////////////////////////////////// -->
		<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
		<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
		<!-- /////////////////////////ajax+시큐리티 사용 시//////////////////////////////////////// -->
	</head>
	<body>
	<th:block th:insert="/common/login.html::login"/>
	<header id="whitetype">
	<div class="view-size">
	<th:block th:replace="~{/common/header::whitetype(~{this::homeMain})}">
		<div class="search" th:fragment="homeMain">
			<div class="big-search" th:fragment="indexMain">
				<ul class="flex">
					<li><a href="/home/list">숙소</a></li> 
					<li><a href="#">체험</a></li>
					<li><a href="#">온라인체험</a></li>
				</ul>
			</div>
		</div>
	</th:block>
	</div>
	</header>
		
		<main>
			<section id="home-reg">
				<div class="home-reg home-reg-view-size">
					<div class="title">
						<span>에어비앤비 호스트가 되어보세요.</span>
						<h2>새로운 숙소 등록하기</h2>
					</div>
					<form action="/home/reg" method="post" enctype="multipart/form-data">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
						<div class="home-reg-info">
							<div class="flex">
								<p>숙소 이름</p>
								<div class="home-name">
									<input name="homeName" type="text" placeholder="숙소 이름을 입력하세요">
								</div>
							</div>
							<div class="flex">
								<p>숙소 주소</p>
								<div class="home-address-part">
									<div><input id="address" name="homeAddress" type="text" placeholder="주소를 입력하세요" autocomplete="off" required="required"></div>
									<div><input type="text" id="detailAddress" placeholder="상세주소를 입력하세요" autocomplete="off"></div>
									<input type="hidden" id="postcode" placeholder="우편번호">
									<input type="hidden" id="extraAddress" placeholder="참고항목">
								</div>
							</div>
							<div class="flex">
								<p>숙소가격</p>
								<div class="homePrice">
									<input name="homePrice" type="text" placeholder="하루 숙박 요금을 입력하세요">
								</div>
							</div>
							<div class="flex">
								<p>숙소상세정보</p>
								<div class="home-detail-number flex center select-view-size">
									<div class="flex">
										<p>최대 인원 : </p>
										<input name="maximumNumber" type="text"><span>명</span>
									</div>
									<div class="flex">
										<p>침대 개수 : </p>
										<input name="bedNumber" type="text"><span>개</span>
									</div>
									<div class="flex">
										<p>침실 개수 : </p>
										<input name="bedroomNumber" type="text"><span>개</span>
									</div>
									<div class="flex">
										<p>욕실 개수 : </p>
										<input name="bathroomNumber" type="text"><span>개</span>
									</div>
								</div>
							</div>
							<div class="flex">
								<p>숙소유형</p>
								<div class="home-type flex between select-view-size">
									<label for="homeType1" class="box-radio-input"><input name="homeType" type="radio" id="homeType1" value="apartment"><span>아파트</span></label>
									<label for="homeType2" class="box-radio-input"><input name="homeType" type="radio" id="homeType2" value="house"><span>주택</span></label>
									<label for="homeType3" class="box-radio-input"><input name="homeType" type="radio" id="homeType3" value="outhouse"><span>별채</span></label>
								</div>
							</div>
							<div class="flex home-option">
								<p>편의시설</p>
								<div>
									<div class="flex between select-view-size">
										<input name="homeOption" type="checkbox" id="homeOption1" value="wifi">
										<label for="homeOption1" class="checkbox-style">
											<i class="fas fa-wifi"></i>
											<span>WIFI</span>
										</label>
										<input name="homeOption" type="checkbox" id="homeOption2" value="tv">
										<label for="homeOption2" class="checkbox-style">
											<i class="fas fa-tv"></i>
											<span>TV</span>
										</label>
										<input name="homeOption" type="checkbox" id="homeOption3" value="washer">
										<label for="homeOption3" class="checkbox-style">
											<i class="fas fa-water"></i>
											<span>세탁기</span>
										</label>
									</div>
									<div class="flex between select-view-size">
										<input name="homeOption" type="checkbox" id="homeOption4" value="parking">
										<label for="homeOption4" class="checkbox-style">
											<i class="fas fa-parking"></i>
											<span>주차장</span>
										</label>
										<input name="homeOption" type="checkbox" id="homeOption5" value="pool">
										<label for="homeOption5" class="checkbox-style">
											<i class="fas fa-swimming-pool"></i>
											<span>수영장</span>
										</label>
										<input name="homeOption" type="checkbox" id="homeOption6" value="kitchen">
										<label for="homeOption6" class="checkbox-style">
											<i class="fas fa-utensils"></i>
											<span>주방</span>
										</label>
									</div>
								</div>
							</div>
							<div class="flex">
								<p>숙소소개</p>
								<div class="home-intro flex between">
									<textarea name="homeIntro"></textarea>									
								</div>
							</div>
							
							
							<div class="flex">
								<p>커버 이미지</p>
								<div class="main-image">
									<label for="main-img" class="main-style">
										<i class="far fa-images"></i>
									</label>
									<img class="main-image-disp image-disp">
									<input class="imageName" type="hidden" value="main-img">
									<input name="mainImg" type="file" id="main-img" style="display: none;">
								</div>
							</div>
							
							<div class="flex">
								<p>상세 이미지</p>
								<div>
									<div class="flex between sub-image">
										<div class="sub-image-content">
											<label for="sub1-img" class="sub-style">
												<i class="far fa-images"></i>
											</label>
											<img class="sub-image-disp image-disp">
											<input class="imageName" type="hidden" value="sub1-img">
											<input name="sub1Img" type="file" style="display: none;" id="sub1-img">
										</div>
										<div class="sub-image-content">
											<label for="sub2-img" class="sub-style">
												<i class="far fa-images"></i>
											</label>
											<img class="sub-image-disp image-disp">
											<input class="imageName" type="hidden" value="sub2-img">
											<input name="sub2Img" type="file" style="display: none;" id="sub2-img">
										</div>
									</div>
									<div class="flex between sub-image">
										<div class="sub-image-content">
											<label for="sub3-img" class="sub-style">
												<i class="far fa-images"></i>
											</label>
											<img class="sub-image-disp image-disp">
											<input class="imageName" type="hidden" value="sub3-img">
											<input name="sub3Img" type="file" style="display: none;" id="sub3-img">
										</div>
										<div class="sub-image-content">
											<label for="sub4-img" class="sub-style">
												<i class="far fa-images"></i>
											</label>
											<img class="sub-image-disp image-disp">
											<input class="imageName" type="hidden" value="sub4-img">
											<input name="sub4Img" type="file" style="display: none;" id="sub4-img">
										</div>
									</div>
									<button type="submit">등록하기</button>
								</div>
							</div>
							
							<script type="text/javascript">
								$(function(){
									
									var token = $("meta[name='_csrf']").attr("content");
									var header = $("meta[name='_csrf_header']").attr("content");
									
									 $(document).ajaxSend(function(e, xhr, options) {
									        xhr.setRequestHeader(header, token);
								    });
									 
									$("#main-img").change(tempUpload);
									$("#sub1-img").change(tempUpload);
									$("#sub2-img").change(tempUpload);
									$("#sub3-img").change(tempUpload);
									$("#sub4-img").change(tempUpload);
									
								});
								
								
								function tempUpload(){
									
									//input 태그의 file에 접근자
									//console.log($(this)[0].files[0]);
									var fileData=$(this)[0].files[0];
									var formdata=new FormData();
									var imageName=$(this).siblings(".imageName").val();
									
									formdata.append("fileImg", fileData);
									formdata.append("imageName", imageName);
									
									var target=$(this).siblings(".image-disp");
									
									$.ajax({
										url:"/home/reg/tempImgUpload",
										type: "post",
										contentType: false,
										processData: false,
										data: formdata, /* //파일을 추가한 formdata */
										success: function(result){/*  @ResponseBody 문자열이 result변수에 저장  */
											if(result=="fileSize-error"){
												alert("파일용량이 너무큽니다. 2MB제한!");
											}else if(result=="contentType-error"){
												alert("이미지 파일이 아닙니다.");
											}
										
											target.attr("src",result);
										}
									});
								}
								
								
							</script>
							
						</div>
					</form>	
				</div>
			</section>
			<script type="text/javascript">
				$("input:radio[id='homeType1']").prop('checked', true);
				
				window.onload = function(){
				    document.getElementById("address").addEventListener("click", function(){
				        new daum.Postcode({
				            oncomplete: function(data) {
				                var addr = '';
				                var extraAddr = '';

				              
				                if (data.userSelectedType === 'R') {
				                    addr = data.roadAddress;
				                } else {
				                    addr = data.jibunAddress;
				                }

				                if(data.userSelectedType === 'R'){
				                    if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
				                        extraAddr += data.bname;
				                    }
				                    if(data.buildingName !== '' && data.apartment === 'Y'){
				                        extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
				                    }
				                    if(extraAddr !== ''){
				                        extraAddr = ' (' + extraAddr + ')';
				                    }
				                    document.getElementById("extraAddress").value = extraAddr;
				                
				                } else {
				                    document.getElementById("extraAddress").value = '';
				                }

				                document.getElementById('postcode').value = data.zonecode;
				                document.getElementById("address").value = addr;
				                document.getElementById("detailAddress").focus();
				            }
				        }).open();
				    
				    });
				}
			</script>
		</main>
		
		<footer>
			<th:block th:insert="/common/footer::footer"/>	
		</footer>
	
	</body>
</html>